<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>Arrendar</title>

    <!-- Fontfaces CSS-->
    <link href="/static/css/font-face.css" rel="stylesheet" media="all">
    <link href="/static/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">



    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="/static/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="/static/vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">



    <!--Mapa-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="../../static/mapa/L.Control.Locate.js"></script>
    <link rel="stylesheet" href="../../static/mapa/L.Control.Locate.min.css" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet-src.js"></script>


    <!--GeoAdress-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.1.0/dist/geosearch.css" />
    <script src="https://unpkg.com/leaflet-geosearch@3.1.0/dist/geosearch.umd.js"></script>
    <!--RUTA-->

    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.11/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.11/dist/leaflet-routing-machine.js"></script>

    <!--Contador-->
    <script src="https://cdn.jsdelivr.net/npm/easytimer@1.1.1/src/easytimer.min.js"></script>



    <!-- Vendor CSS-->
    <link href="/static/vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="/static/vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="/static/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">
    <link href="/static/vendor/vector-map/jqvmap.min.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="/static/css/theme.css" rel="stylesheet" media="all">



</head>

<body class="animsition">
    <div class="page-wrapper">
        <!-- HEADER MOBILE-->


        <header class="header-mobile d-block d-lg-none">
            <div class="header-mobile__bar">
                <div class="container-fluid">
                    <div class="header-mobile-inner">
                        <a class="logo" href="index.html">
                            <img src="/static/images/logo_orange.png" alt="CoolAdmin" />
                        </a>
                        <button class="hamburger hamburger--slider" type="button">
                            <span class="hamburger-box">
                                <span class="hamburger-inner"></span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <nav class="navbar-mobile">
                <div class="container-fluid">
                    <ul class="navbar-mobile__list list-unstyled">
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-tachometer-alt"></i>Dashboard</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="/Dashboard">Dashboard 1</a>
                                </li>

                            </ul>
                        </li>

                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-user"></i>Cuenta</a>
                            <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                <li>
                                    <a href="#">Mis Recorridos</a>
                                </li>
                                <li>
                                    <a href="register.html">Register</a>
                                </li>
                                <li>
                                    <a href="forget-pass.html">Forget Password</a>
                                </li>
                            </ul>
                        </li>

                </div>
            </nav>
        </header>
        <!-- END HEADER MOBILE-->

        <!-- MENU SIDEBAR-->
        <aside class="menu-sidebar d-none d-lg-block">
            <div class="logo">
                <a href="#">
                    <img src="/static/images/logo_orange.png" alt="Cool Admin" />
                </a>
            </div>
            <div class="menu-sidebar__content js-scrollbar1">
                <nav class="navbar-sidebar">
                    <ul class="list-unstyled navbar__list">
                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-tachometer-alt"></i>Dashboard</a>
                            <ul class="list-unstyled navbar__sub-list js-sub-list">

                            </ul>
                        </li>

                        <li class="has-sub">
                            <a class="js-arrow" href="#">
                                <i class="fas fa-user"></i>Cuenta</a>
                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                <li>
                                    <a href="login.html">Login</a>
                                </li>
                                <li>
                                    <a href="register.html">Register</a>
                                </li>
                                <li>
                                    <a href="forget-pass.html">Forget Password</a>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </nav>
            </div>
        </aside>
        <!-- END MENU SIDEBAR-->

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- HEADER DESKTOP-->
            <header class="header-desktop">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="header-wrap">
                            <form class="form-header" action="" method="POST">
                                <input class="au-input au-input--xl" type="text" name="search"
                                    placeholder="Search for datas &amp; reports..." />
                                <button class="au-btn--submit" type="submit">
                                    <i class="zmdi zmdi-search"></i>
                                </button>
                            </form>
                            <div class="header-button">
                                <div class="noti-wrap">
                                    <div class="noti__item js-item-menu">
                                        <i class="zmdi zmdi-comment-more"></i>
                                        <span class="quantity">1</span>
                                        <div class="mess-dropdown js-dropdown">
                                            <div class="mess__title">
                                                <p>You have 2 news message</p>
                                            </div>
                                            <div class="mess__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-06.jpg" alt="Michelle Moreno" />
                                                </div>
                                                <div class="content">
                                                    <h6>Michelle Moreno</h6>
                                                    <p>Have sent a photo</p>
                                                    <span class="time">3 min ago</span>
                                                </div>
                                            </div>
                                            <div class="mess__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-04.jpg" alt="Diane Myers" />
                                                </div>
                                                <div class="content">
                                                    <h6>Diane Myers</h6>
                                                    <p>You are now connected on message</p>
                                                    <span class="time">Yesterday</span>
                                                </div>
                                            </div>
                                            <div class="mess__footer">
                                                <a href="#">View all messages</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="noti__item js-item-menu">
                                        <i class="zmdi zmdi-email"></i>
                                        <span class="quantity">1</span>
                                        <div class="email-dropdown js-dropdown">
                                            <div class="email__title">
                                                <p>You have 3 New Emails</p>
                                            </div>
                                            <div class="email__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-06.jpg" alt="Cynthia Harvey" />
                                                </div>
                                                <div class="content">
                                                    <p>Meeting about new dashboard...</p>
                                                    <span>Cynthia Harvey, 3 min ago</span>
                                                </div>
                                            </div>
                                            <div class="email__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-05.jpg" alt="Cynthia Harvey" />
                                                </div>
                                                <div class="content">
                                                    <p>Meeting about new dashboard...</p>
                                                    <span>Cynthia Harvey, Yesterday</span>
                                                </div>
                                            </div>
                                            <div class="email__item">
                                                <div class="image img-cir img-40">
                                                    <img src="images/icon/avatar-04.jpg" alt="Cynthia Harvey" />
                                                </div>
                                                <div class="content">
                                                    <p>Meeting about new dashboard...</p>
                                                    <span>Cynthia Harvey, April 12,,2018</span>
                                                </div>
                                            </div>
                                            <div class="email__footer">
                                                <a href="#">See all emails</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="noti__item js-item-menu">
                                        <i class="zmdi zmdi-notifications"></i>
                                        <span class="quantity">3</span>
                                        <div class="notifi-dropdown js-dropdown">
                                            <div class="notifi__title">
                                                <p>You have 3 Notifications</p>
                                            </div>
                                            <div class="notifi__item">
                                                <div class="bg-c1 img-cir img-40">
                                                    <i class="zmdi zmdi-email-open"></i>
                                                </div>
                                                <div class="content">
                                                    <p>You got a email notification</p>
                                                    <span class="date">April 12, 2018 06:50</span>
                                                </div>
                                            </div>
                                            <div class="notifi__item">
                                                <div class="bg-c2 img-cir img-40">
                                                    <i class="zmdi zmdi-account-box"></i>
                                                </div>
                                                <div class="content">
                                                    <p>Your account has been blocked</p>
                                                    <span class="date">April 12, 2018 06:50</span>
                                                </div>
                                            </div>
                                            <div class="notifi__item">
                                                <div class="bg-c3 img-cir img-40">
                                                    <i class="zmdi zmdi-file-text"></i>
                                                </div>
                                                <div class="content">
                                                    <p>You got a new file</p>
                                                    <span class="date">April 12, 2018 06:50</span>
                                                </div>
                                            </div>
                                            <div class="notifi__footer">
                                                <a href="#">All notifications</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-wrap">
                                    <div class="account-item clearfix js-item-menu">
                                        <div class="image">
                                            <img src="../images/{{profileImage}}" alt="John Doe" />
                                        </div>
                                        <div class="content">
                                            <a class="js-acc-btn" href="#">{{username}}</a>
                                        </div>
                                        <div class="account-dropdown js-dropdown">
                                            <div class="info clearfix">
                                                <div class="image">
                                                    <a href="#">
                                                        <img src="../images/{{profileImage}}" alt="John Doe" />
                                                    </a>
                                                </div>
                                                <div class="content">
                                                    <h5 class="name">
                                                        <a href="#">{{username}}</a>
                                                    </h5>
                                                    <span class="email">{{username}}</span>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__body">
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-account"></i>Account</a>
                                                </div>
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-settings"></i>Cuenta</a>
                                                </div>
                                                <div class="account-dropdown__item">
                                                    <a href="#">
                                                        <i class="zmdi zmdi-money-box"></i>Pago</a>
                                                </div>
                                            </div>
                                            <div class="account-dropdown__footer">
                                                <a href="../logout">
                                                    <i class="zmdi zmdi-power"></i>Cerrar Sesion</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- END HEADER DESKTOP-->

            <div class="main-content">
                <div class="section__content section__content--p30">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <!-- MAP DATA-->
                                {% if travel %}
                                <div class="sufee-alert alert with-close alert-success alert-dismissible fade show">
                                    <span class="badge badge-pill badge-success">Exito</span>
                                    Trayecto Agregado Correctamente :).
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                {% endif %}

                                <div class="map-data m-b-40">
                                    <h3 class="title-3 m-b-30">
                                        <i class="zmdi zmdi-map"></i> Arrendar</h3>
                                    <div class="filters">
                                        <div class="rs-select2--dark rs-select2--md m-r-10 rs-select2--border">
                                            <select class="js-select2" id="DisplayEstaciones"
                                                onchange="GetSelectStation(this);" name="property">
                                                <option selected value="seleccione estacion">Seleccione estacion
                                                </option>
                                                {% for estacion in listStations%}

                                                <option value="{{estacion.name}}">{{estacion.name}}</option>
                                                {% endfor %}
                                            </select>

                                            <div class="dropDownSelect2"></div>

                                        </div>
                                        <button type="button" class="btn btn-primary" onclick="getLocation()"><i
                                                class="fa fa-bicycle">
                                            </i>Arrendar</button>

                                        <div class="dropDownSelect2"></div>

                                        <div class="filters">
                                            <div class="rs-select2--dark rs-select2--sm rs-select2--border">
                                                <div style="display: none ; padding: 10px; font-size: 18px;  "
                                                    id="basicUsage" class="au-select-dark">00:00:00</div>
                                                <button type="button" id="TerminarViaje" onclick="getLocation_Finish()"
                                                    style="display: none; padding: 10px; background-color: #FF5722; border: #FF5722 ; "
                                                    class="btn btn-primary">
                                                    <i class="fa fa-bicycle" style="padding: 5px;"></i>Finalizar
                                                    Trayecto</button>
                                            </div>

                                            <div id="map" class=" m-b-40"
                                                style="height: 400px;  margin-left:-20px; margin-top:30px ;">
                                            </div>

                                        </div>

                                    </div>
                                </div>
                                <!-- END MAP DATA-->
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="copyright">
                                    <p id="demo"></p>

                                    <p>Copyright © 2018 Colorlib. All rights reserved. Template by <a
                                            href="https://colorlib.com">Colorlib</a>.</p>
                                    <div id="number" style="display: none;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Jquery JS-->
    <script src="/static/vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="/static/vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="/static/vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="/static/vendor/slick/slick.min.js">
    </script>
    <script src="/static/vendor/wow/wow.min.js"></script>
    <script src="/static/vendor/animsition/animsition.min.js"></script>
    <script src="/static/vendor/bootstrap-progressbar/bootstrap-progressbar.min.js">
    </script>
    <script src="/static/vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="/static/vendor/counter-up/jquery.counterup.min.js">
    </script>
    <script src="/static/vendor/circle-progress/circle-progress.min.js"></script>
    <script src="/static/vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="/static/vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="/static/vendor/select2/select2.min.js">
    </script>



    <!--Map-->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.72.0/src/L.Control.Locate.min.js"
        charset="utf-8"></script>
    <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>






    <script>
        var timer = new Timer();/* contador de tiempo usuario*/
        var segundos_valor = 0;
        var divSegundos = document.getElementById("number"); /*contador segundos*/
        var lat_destino, lon_destino, Nombre_destino,Nombre_inicio,nombre_estacionamiento;
        var lat_actual, lon_actual;
        const provider = new GeoSearch.BingProvider({
            params: {
                key: 'AgBxeF9_Du7s-MRwc44BPh56F0XdA1FBc-lSXqmCdtmAKk6wawbUKY8G93kN5Odw',
            },
        });



        const searchControl = new GeoSearch.GeoSearchControl({
            provider: provider,
            style: 'bar',
            showMarker: true, // optional: true|false  - default true
            marker: {
                // optional: L.Marker    - default L.Icon.Default
                icon: new L.Icon.Default(),
                draggable: false,
            },
            popupFormat: ({ query, result }) => "<a onclick='CodBicicleta()' style='pointer:cursor;'>Confirmar Destino</a>",
            searchLabel: 'Ingresa Destino', // optional: string      - default 'Enter address'


        });


        var EstacionSeleccionada = ""
        var osmUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var osmAttrib = 'Map data © <a href="http://osm.org/copyright">OpenStreetMap</a> contributors';
        var osm = new L.TileLayer(osmUrl, {
            attribution: osmAttrib,
            detectRetina: true
        });

        // please replace this with your own mapbox token!
        var token = 'pk.eyJ1IjoibWFudWVsMjEyMTEzIiwiYSI6ImNraG1vanRwbjBkMWkycW1rZ2lobWprZncifQ.BZYsaF7Bs7K3WKY6rGR1Fg';
        var mapboxUrl = 'https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/{z}/{x}/{y}@2x?access_token=' + token;
        var mapboxAttrib = 'Map data © <a href="http://osm.org/copyright">OpenStreetMap</a> contributors. Tiles from <a href="https://www.mapbox.com">Mapbox</a>.';
        var mapbox = new L.TileLayer(mapboxUrl, {
            attribution: mapboxAttrib,
            tileSize: 512,
            zoomOffset: -1
        });




        var map = new L.Map('map', {
            layers: [mapbox],
            center: [51.505, -0.09],
            zoom: 18,
            zoomControl: true
        });

        // add location control to global name space for testing only
        // on a production site, omit the "lc = "!

        map.addControl(L.control.locate({
            locateOptions: {
                enableHighAccuracy: true
            },
            strings: {
                title: "Buscar mi Ubicación!",
                popup: " Margen de precision de : {distance} metros"
            }

        }));







        let iconPark = L.icon({
            iconUrl: '../static/images/marker_estacionamiento.png',
            iconSize: [70, 70],
            iconAnchor: [40, 40],
            popupAnchor: [-1, -10]
        })


        let iconMarker = L.icon({
            iconUrl: '../static/images/marker.png',
            iconSize: [70, 70],
            iconAnchor: [40, 40],
            popupAnchor: [-5, -30]

        })


        // Estaciones de biciciletas desde la base de datos//
        

        // Estacionamientos desde la Base de datos
        BikeParking = {}
        BikeParking = {{ Park | safe }};

        Bikes = {}
        Bikes = {{ Bikes | safe }};

        BikeStations_All = {}
        BikeStations_All = {{ BikeStations | safe }};




        for (i in BikeParking) {
            L.marker([BikeParking[i]["fields"].Latitude, BikeParking[i]["fields"].Longitude, 19], { icon: iconPark }).bindPopup(BikeParking[i]["fields"].name + '').addTo(map)



        }



        for (i in BikeStations_All) {
            L.marker([BikeStations_All[i]["fields"].Latitude, BikeStations_All[i]["fields"].Longitude, 19], { icon: iconMarker }).bindPopup(BikeStations_All[i]["fields"].name + '').addTo(map)
        }






        






        function GetSelectStation(element) {
            EstacionSeleccionada = element.options[element.selectedIndex].text;
        }


        function CodBicicleta() {
            var cod_bicicleta;
            (async () => {
                const { value: formValues } = await Swal.fire({
                    title: 'Codigo Bicicleta',
                    inputLabel: 'Ingrese el Codigo de la Bicicleta',
                    icon: 'info',
                    html:
                        '<input id="swal-input1" class="swal2-input">',
                    focusConfirm: false,
                    preConfirm: () => {
                        return [
                            cod_bicicleta = document.getElementById('swal-input1').value,
                        ]
                    }
                })

                if (formValues) {
                    for (i in Bikes) {
                        if (Bikes[i]["fields"].code_bike == cod_bicicleta) {

                            Swal.fire(
                                'Bicicleta Encontrada!',
                                'Se marcara la ruta en el mapa.',
                                'success'

                            )
                            searchControl.remove();

                            /* aqui abajo se obtiene la direccion(calle 213) de la latitud y longitud actual del cliente */
                            $.get('https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=' + lat_actual + '&lon=' + long_actual, function (data) {
                                Nombre_inicio=(data.address.road + " " + data.address.state);
                            });

                            $.get('https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=' + lat_destino + '&lon=' + lon_destino, function (data) {
                                Nombre_destino=(data.address.road + " " + data.address.state);
                            });
                            var control = L.Routing.control({

                                "type": "LineString",
                                language: 'es',

                                waypoints: [
                                    L.latLng(lat_destino, lon_destino),
                                    L.latLng(lat_actual, long_actual)
                                ],


                                lineOptions: {
                                    styles: [
                                        { color: 'black', opacity: 0.15, weight: 9 },
                                        { color: 'white', opacity: 0.8, weight: 6 },
                                        { color: 'orange', opacity: 1, weight: 2 }
                                    ],
                                    missingRouteStyles: [
                                        { color: 'black', opacity: 0.5, weight: 7 },
                                        { color: 'white', opacity: 0.6, weight: 4 },
                                        { color: 'gray', opacity: 0.8, weight: 2, dashArray: '7,12' }
                                    ]
                                },

                                show: true,
                                addWaypoints: false,
                                autoRoute: true,
                                routeWhileDragging: false,
                                draggableWaypoints: false,
                                useZoomParameter: false,
                                showAlternatives: true,

                            }).addTo(map)


                            control.on('routesfound', function (e) {
                                var routes = e.routes;
                                var summary = routes[0].summary;
                                var tiempoextra = Math.round(summary.totalTime % 3600 / 60 * 0.30) + Math.round(summary.totalTime % 3600 / 60);
                                tiempoextra = tiempoextra + " Minutos"



                                Swal.fire(
                                    'Tiempo de Trayecto!',
                                    'el tiempo de trayecto estimado es de ' + tiempoextra,
                                    'info'

                                )
                                $("#basicUsage").show();

                                $("#TerminarViaje").show();

                                window.setInterval(function () {
                                    divSegundos.innerHTML = segundos_valor;
                                    segundos_valor++;
                                }, 1000);

                                timer.start();

                                timer.addEventListener('secondsUpdated', function (e) {
                                    $('#basicUsage').html(timer.getTimeValues().toString());
                                });
                            });


                        } else {
                            Swal.fire(
                                'Bicicleta No Encontrada!',
                                'No se ha encontrado la bicicleta con el codigo ingresado.',
                                'error'

                            )
                        }
                    }

                }
            })();
        }



        function getLocation_Finish() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(FinishTravel);
            } else {
                alert("Geolocation no esta soportado en este navegador.");
            }
        }

        function round(value, decimals) {
            return Number(Math.round(value + 'e' + decimals) + 'e-' + decimals);
        }

        function FinishTravel(position) {

            valor_final = segundos_valor * 0.11111111111;
            round(valor_final, 2);
            valorString = valor_final.toString();

            for (i in BikeParking) {
                /* dist calcula da distancia entre la posicion actual y la posicion del estacionamiento solo accediendo si es menor o igual a 0.1 (10 metros)*/
                var dist = distance(position.coords.latitude, position.coords.longitude, BikeParking[i]["fields"].Latitude, BikeParking[i]["fields"].Longitude, "K")
                if (dist <= 0.1 || dist == 0) {
                     nombre_estacionamiento = BikeParking[i]["fields"].name




                    alert("Cargando");
                    Swal.mixin({
                        confirmButtonText: 'OK',
                        showCancelButton: false,
                        progressSteps: ['1', '2', '3']

                    }).queue([
                        {
                            icon: 'info',
                            title: 'Valor A Pagar',
                            html: 'Tiempo Trayecto: ' + timer.getTimeValues().toString() + ' <br> Monto a Pagar: ' + valorString.substr(0, 3) + " pesos",

                        },
                        {
                            icon: 'warning',
                            title: 'Estacionamiento Bicicleta',
                            html: 'Debes Estacionar en: <br><strong>' + nombre_estacionamiento + '</strong><br> para finalizar el viaje',


                        },
                        {
                            icon: 'info',
                            title: 'Verificando Bicicleta Estacionada',
                            showConfirmButton: false,
                            timer: 3500
                        },


                   
                    ]).then((result) => {
                        Swal.fire(
                            'Trayecto Finalizado Correctamente!',
                            'El valor total sera Descontado de tu tarjeta' + '<br> Adios ',
                            'success'

                        )
                        window.location = "/Dashboard/rent/add/" + {{user_id}}+"/"+Nombre_destino+"/"+EstacionSeleccionada+"/"+nombre_estacionamiento


                    })

                























                } else {
                    Swal.fire(
                        'Error!',
                        'Estas muy lejos del estacionamiento.',
                        'error'

                    )
                }

            }
        }


        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getUserPosition);
            } else {
                alert("Geolocation no esta soportado en este navegador.");
            }
        }

        function search(nameKey, myArray) {
            for (var i = 0; i < myArray.length; i++) {
                if (myArray[i].name === nameKey) {
                    return myArray[i];
                }
            }
        }
        getLocation();


        function getUserPosition(position) {










            for (i in BikeStations_All) {


                if (BikeStations_All[i]["fields"].name == EstacionSeleccionada) {
                    var dist = distance(position.coords.latitude, position.coords.longitude, BikeStations_All[i]["fields"].Latitude, BikeStations_All[i]["fields"].Longitude, "K")
                    lat_actual = position.coords.latitude;
                    long_actual = position.coords.longitude;
                    var dist2 = Math.round(dist, -10);
                    dist = Math.round(dist * 100) / 100;
                    if (dist <= 0.1 || dist == 0) {


                        //Aqui va si esta cerca de 100 metros(el gps no es 100% exacto)

                        Swal.fire(
                            'Distancia Correcta!',
                            'Ingresa La Direccion de tu Destino en la parte superior del mapa.',
                            'success'

                        )
                        console.log(searchControl);
                        map.addControl(searchControl);

                        map.on('geosearch/showlocation', function (e) {
                            $("#lat").val(e.location.y);
                            $("#lng").val(e.location.x);
                            lat_destino = e.location.y;
                            lon_destino = e.location.x;
                            console.log(e);













                        });






                    } else {
                        Swal.fire(
                            'Error!',
                            'Estas muy Lejos de La Estacion.',
                            'error'

                        )
                    }


                } else {

                }


            }
        }





        function stateChange(newState) {
            setTimeout(function () {
                if (newState == -1) { alert('Buscando Ubicacion'); }
            }, 5000);
        }


        function distance(lat1, lon1, lat2, lon2, unit) {
            if ((lat1 == lat2) && (lon1 == lon2)) {
                return 0;
            }
            else {
                var radlat1 = Math.PI * lat1 / 180;
                var radlat2 = Math.PI * lat2 / 180;
                var theta = lon1 - lon2;
                var radtheta = Math.PI * theta / 180;
                var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
                if (dist > 1) {
                    dist = 1;
                }
                dist = Math.acos(dist);
                dist = dist * 180 / Math.PI;
                dist = dist * 60 * 1.1515;
                if (unit == "K") { dist = dist * 1.609344 }
                if (unit == "N") { dist = dist * 0.8684 }
                return dist;
            }
        }



    </script>
    <!-- Main JS-->
    <script src="/static/js/main.js"></script>

</body>

</html>
<!-- end document-->